# IMPERION: REINOS EN GUERRA - HISTORIAL DE CAMBIOS

## Versi√≥n 1.0.33 - Modularizaci√≥n de UI de Comercio Privado (Renderizado de Items)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de PrivateTradeUIManager.js y PrivateTradeUIHelper.js
- Se movi√≥ la l√≥gica de generaci√≥n del HTML para la lista de √≠tems de comercio privado (`renderPrivateTradeItems` que conten√≠a el bucle de mapeo y la l√≥gica de cada `trade-item-entry`) de `PrivateTradeUIManager.js` a `PrivateTradeUIHelper.js`.
- `PrivateTradeUIHelper.js` ahora contiene un nuevo m√©todo `generateTradeItemsListHtml` que es responsable de construir el HTML de la lista de elementos para el jugador o el NPC.
- `PrivateTradeUIManager.js` ahora llama a `this.privateTradeUIHelper.generateTradeItemsListHtml()` y simplemente asigna el HTML resultante a los elementos del DOM, delegando completamente la creaci√≥n del marcado de los √≠tems.
- Adem√°s, `PrivateTradeUIHelper.js` ahora recibe instancias de `PrivateTradeOfferState` y `PrivateTradeUIManager` en su constructor para acceder directamente a los datos de la oferta y para que los callbacks `onclick` en el HTML generado puedan referenciar correctamente los m√©todos de `PrivateTradeUIManager`.
- Esta modularizaci√≥n reduce a√∫n m√°s la complejidad de `PrivateTradeUIManager.js`, separando la responsabilidad de renderizado de un item individual y de la lista de la orquestaci√≥n general de la UI del modal.

## Versi√≥n 1.0.32 - Modularizaci√≥n de UI de Comercio Privado (Opciones de Art√≠culo)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de PrivateTradeUIManager.js y PrivateTradeUIHelper.js
- Se movi√≥ la l√≥gica de actualizaci√≥n de las opciones de art√≠culos en el selector (`updatePrivateItemOptions`) de `PrivateTradeUIManager.js` a `PrivateTradeUIHelper.js`.
- `PrivateTradeUIManager.js` ahora delega la llamada a `updatePrivateItemOptions` a su instancia de `PrivateTradeUIHelper.js`.
- Esta modularizaci√≥n sigue separando la l√≥gica de renderizado del DOM y la preparaci√≥n de los elementos de UI (que ahora incluye la carga din√°mica de opciones en los selectores) de la gesti√≥n del estado y la interacci√≥n principal en `PrivateTradeUIManager.js`.

## Versi√≥n 1.0.31 - Modularizaci√≥n de UI de Comercio Privado (Generaci√≥n HTML)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de PrivateTradeUIManager.js y PrivateTradeUIHelper.js
- Se movi√≥ la l√≥gica de generaci√≥n del HTML del modal de comercio privado (`_generatePlayerPanelHtml`, `_generateNegotiationCenterHtml`, `_generateNpcPanelHtml`, `_generateTradeItemSelectorHtml`) de `PrivateTradeUIManager.js` a un nuevo archivo `PrivateTradeUIHelper.js`.
- `PrivateTradeUIManager.js` ahora instancia `PrivateTradeUIHelper.js` y delega la construcci√≥n de las partes del HTML del modal a esta nueva clase.
- Esta modularizaci√≥n reduce a√∫n m√°s la complejidad de `PrivateTradeUIManager.js`, separando la l√≥gica de renderizado del DOM de la gesti√≥n del estado de la UI y la interacci√≥n con el usuario.

## Versi√≥n 1.0.30 - Modularizaci√≥n de UI de Comercio Privado (Control de Cantidad)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de PrivateTradeManager.js y PrivateTradeUIManager.js
- Se movi√≥ la l√≥gica de manipulaci√≥n de la cantidad de art√≠culos listados en el comercio privado (`updatePrivateListedItemAmount`, `setPrivateListedItemMax`, `setPrivateListedItemPercentage`) de `PrivateTradeManager.js` a `PrivateTradeUIManager.js`.
- `PrivateTradeUIManager.js` ahora es directamente responsable de actualizar el estado de la oferta a trav√©s de `PrivateTradeOfferState` y refrescar la interfaz de usuario de los elementos individuales.
- Esta modularizaci√≥n reduce a√∫n m√°s la complejidad de `PrivateTradeManager.js`, separando claramente la l√≥gica de presentaci√≥n y manipulaci√≥n de la UI del estado y la l√≥gica de negocio central del comercio privado.

## Versi√≥n 1.0.29 - Modularizaci√≥n de L√≥gica de Comercio Privado
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de PrivateTradeManager.js y PrivateTradeLogic.js
- Se movi√≥ la l√≥gica central de las negociaciones de comercio privado (`suggestCounterOffer`, `proposePrivateTrade`) de `PrivateTradeManager.js` a un nuevo archivo `PrivateTradeLogic.js`.
- `PrivateTradeManager.js` ahora instancia `PrivateTradeLogic.js` en su constructor y delega la ejecuci√≥n de estas funciones de negocio a esta nueva clase.
- Esta modularizaci√≥n reduce la complejidad de `PrivateTradeManager.js`, separando las responsabilidades de coordinaci√≥n de la UI y el estado (que mantiene `PrivateTradeManager` a trav√©s de `PrivateTradeUIManager` y `PrivateTradeOfferState`) de la l√≥gica de evaluaci√≥n y ejecuci√≥n del comercio en s√≠.

## Versi√≥n 1.0.28 - Modularizaci√≥n del Sistema de Chat (UI Lazy Load)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de index.html y ChatSystem.js
- Se movi√≥ el c√≥digo HTML del sistema de chat (`.chat-content-wrapper` y sus hijos) de `index.html` a un nuevo archivo `chat-panel.html`.
- `index.html` ahora contiene un contenedor vac√≠o (`#chatSystem`) donde la UI del chat se carga din√°micamente.
- `ChatSystem.js` fue modificado para:
    - Cargar el contenido de `chat-panel.html` mediante `fetch` solo la primera vez que se interact√∫a con el chat (al expandirlo).
    - Almacenar referencias a los elementos internos del chat (`#chatToggle`, `#chatMessages`, `#chatInput`, etc.) despu√©s de que el HTML ha sido inyectado en el DOM.
    - Asegurarse de que los event listeners para enviar mensajes y cambiar de canal se adjunten a los elementos correctos despu√©s de la carga din√°mica, y solo una vez.
- Esta modularizaci√≥n reduce a√∫n m√°s el tama√±o inicial de `index.html` y mejora el tiempo de carga del juego, ya que la interfaz del chat (que no siempre est√° visible o en uso) no se carga hasta que es necesaria.

## Versi√≥n 1.0.27 - Modularizaci√≥n de Modal de Acciones (UI Lazy Load)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de index.html y UIManager.js
- Se movi√≥ el c√≥digo HTML del modal de acciones (`#actionModal`) de `index.html` a un nuevo archivo `game-modals.html`.
- `index.html` ahora contiene un contenedor vac√≠o (`#modalContainer`) donde la UI del modal se carga din√°micamente.
- `UIManager.js` fue modificado para:
    - Cargar el contenido de `game-modals.html` mediante `fetch` solo la primera vez que se llama a `showModal()`.
    - Almacenar referencias a los elementos del modal (`#actionModal`, `#modalBody`, etc.) despu√©s de que el HTML ha sido inyectado en el DOM.
    - Asegurarse de que los event listeners para cerrar el modal se adjunten a los elementos correctos despu√©s de la carga din√°mica, y solo una vez.
- Esta modularizaci√≥n reduce a√∫n m√°s el tama√±o inicial de `index.html` y mejora el tiempo de carga del juego, ya que la interfaz del modal (que es transitoria) no se carga hasta que es necesaria.

## Versi√≥n 1.0.26 - Modularizaci√≥n de Panel de Administraci√≥n (UI Lazy Load)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de index.html y AdminTools.js
- Se movi√≥ el c√≥digo HTML del panel de administraci√≥n (`#adminPanel`) de `index.html` a un nuevo archivo `admin-panel.html`.
- `index.html` ahora contiene un contenedor vac√≠o (`#adminPanelContainer`) donde la UI del panel de administraci√≥n se carga din√°micamente.
- `AdminTools.js` fue modificado para:
    - Cargar el contenido de `admin-panel.html` mediante `fetch` solo la primera vez que se activa el modo de administraci√≥n (`enable()`).
    - Almacenar referencias a los elementos del panel (botones, inputs, etc.) despu√©s de que el HTML ha sido inyectado en el DOM.
    - Asegurarse de que los event listeners se adjunten a los elementos correctos despu√©s de la carga din√°mica.
- Esta modularizaci√≥n reduce el tama√±o inicial de `index.html` y mejora el tiempo de carga del juego, ya que la interfaz de administraci√≥n (que no se usa a menudo) no se carga hasta que es necesaria.

## Versi√≥n 1.0.25 - Modularizaci√≥n de UI de Venta al Mercado
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de MarketSellManager.js y MarketSellUIManager.js
- Se movi√≥ la l√≥gica de generaci√≥n y actualizaci√≥n de la interfaz de usuario del modal de venta (`openSellToMarketModal`, `updateSellItemOptions`, `setSellAmountMax`, `updateSellPriceDisplay`) de `MarketSellManager.js` a un nuevo archivo `MarketSellUIManager.js`.
- `MarketSellManager.js` ahora instancia `MarketSellUIManager.js` en su constructor, delegando la gesti√≥n de la UI a esta nueva clase.
- Esta modularizaci√≥n asegura que `MarketSellManager.js` se centre exclusivamente en la l√≥gica de negocio para la ejecuci√≥n de la venta, mientras que `MarketSellUIManager.js` maneja la presentaci√≥n, mejorando la separaci√≥n de responsabilidades.

## Versi√≥n 1.0.24 - Modularizaci√≥n de Redimensionado del Lienzo del Mapa
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de MapRenderer.js y CanvasResizer.js
- Se movi√≥ la l√≥gica de manejo de redimensionamiento del lienzo (`setupCanvas`, `queueResize`, `_resizeCanvasInternal`) de `MapRenderer.js` a un nuevo archivo `CanvasResizer.js`.
- `MapRenderer.js` ahora instancia `CanvasResizer.js` en su constructor, delegando la gesti√≥n de las dimensiones del lienzo a esta nueva clase.
- Esta modularizaci√≥n asegura que `MapRenderer.js` se centre exclusivamente en las operaciones de dibujo, mientras que `CanvasResizer.js` maneja la reactividad del lienzo a los cambios de tama√±o de su contenedor, mejorando la separaci√≥n de responsabilidades.

## Versi√≥n 1.0.23 - Modularizaci√≥n de UI de Tooltip del Mapa
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de MapInteractionManager.js y MapTooltipManager.js
- Se movi√≥ la l√≥gica de actualizaci√≥n y ocultamiento del tooltip del mapa (`updateTooltip`, `hideTooltip`) de `MapInteractionManager.js` a un nuevo archivo `MapTooltipManager.js`.
- `MapInteractionManager.js` ahora instancia `MapTooltipManager.js` y delega la funcionalidad del tooltip a esta nueva instancia.
- Esta modularizaci√≥n reduce la complejidad de `MapInteractionManager.js`, separando la l√≥gica de presentaci√≥n del tooltip de las interacciones principales del mapa.

#### üó∫Ô∏è Refactorizaci√≥n de MapRenderer.js y MapInteractionManager.js
- Se movi√≥ la l√≥gica de manejo de eventos del rat√≥n (`handleMouseDown`, `handleMouseMove`, `handleMouseUp`) de `MapRenderer.js` a `MapInteractionManager.js`.
- Se movi√≥ la l√≥gica de control de vista del mapa (`zoom`, `centerOnPlayerCity`) de `MapRenderer.js` a `MapInteractionManager.js`.
- `MapRenderer.js` ahora se enfoca √∫nicamente en la l√≥gica de dibujo del mapa, proporcionando m√©todos (`setOffset`, `setScale`) para que `MapInteractionManager.js` actualice el estado de renderizado.
- Esta modularizaci√≥n mejora la separaci√≥n de responsabilidades, haciendo que `MapRenderer.js` sea puramente un motor de renderizado y `MapInteractionManager.js` sea el controlador de la interacci√≥n del usuario con el mapa.

## Versi√≥n 1.0.22 - Modularizaci√≥n de UI de Comercio Privado (Control de Cantidad)
**Fecha:** Diciembre 2024

### üèóÔ∏è Mejoras Estructurales

#### üóÇÔ∏è Refactorizaci√≥n de PrivateTradeManager.js y PrivateTradeUIManager.js
- Se movi√≥ la l√≥gica de manipulaci√≥n directa del DOM para la actualizaci√≥n de cantidades de art√≠culos y sliders (`updatePrivateListedItemAmount`, `setPrivateListedItemMax`, `setPrivateListedItemPercentage`) de `PrivateTradeManager.js` a `PrivateTradeUIManager.js`.
- `PrivateTradeManager.js` ahora se enfoca √∫nicamente en la l√≥gica de negocio, actualizando el estado interno y delegando las actualizaciones visuales a `PrivateTradeUIManager.js` a trav√©s de un nuevo m√©todo `refreshSinglePrivateItemDisplay`.
- Esta modularizaci√≥n reduce a√∫n m√°s la complejidad de `PrivateTradeManager.js`, separando claramente la l√≥gica de presentaci√≥n de la l√≥gica de negocio del comercio privado.